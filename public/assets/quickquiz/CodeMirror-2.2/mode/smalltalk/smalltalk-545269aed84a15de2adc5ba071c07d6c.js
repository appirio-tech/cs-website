CodeMirror.defineMode("smalltalk",function(a,b){var c=/[+\-/\\*~<>=@%|&?!.:;^]/,d=/true|false|nil|self|super|thisContext/,e=function(a,b){this.next=a,this.parent=b},f=function(a,b,c){this.name=a,this.context=b,this.eos=c},g=function(){this.context=new e(h,null),this.expectVariable=!0,this.indentation=0,this.userIndentationDelta=0};g.prototype.userIndent=function(b){this.userIndentationDelta=b>0?b/a.indentUnit-this.indentation:0};var h=function(a,b,g){var h=new f(null,b,!1),l=a.next();return l==='"'?h=i(a,new e(i,b)):l==="'"?h=j(a,new e(j,b)):l==="#"?(a.eatWhile(/[^ .]/),h.name="string-2"):l==="$"?(a.eatWhile(/[^ ]/),h.name="string-2"):l==="|"&&g.expectVariable?h.context=new e(k,b):/[\[\]{}()]/.test(l)?(h.name="bracket",h.eos=/[\[{(]/.test(l),l==="["?g.indentation++:l==="]"&&(g.indentation=Math.max(0,g.indentation-1))):c.test(l)?(a.eatWhile(c),h.name="operator",h.eos=l!==";"):/\d/.test(l)?(a.eatWhile(/[\w\d]/),h.name="number"):/[\w_]/.test(l)?(a.eatWhile(/[\w\d_]/),h.name=g.expectVariable?d.test(a.current())?"keyword":"variable":null):h.eos=g.expectVariable,h},i=function(a,b){return a.eatWhile(/[^"]/),new f("comment",a.eat('"')?b.parent:b,!0)},j=function(a,b){return a.eatWhile(/[^']/),new f("string",a.eat("'")?b.parent:b,!1)},k=function(a,b,c){var d=new f(null,b,!1),e=a.next();return e==="|"?(d.context=b.parent,d.eos=!0):(a.eatWhile(/[^|]/),d.name="variable"),d};return{startState:function(){return new g},token:function(a,b){b.userIndent(a.indentation());if(a.eatSpace())return null;var c=b.context.next(a,b.context,b);return b.context=c.context,b.expectVariable=c.eos,b.lastToken=c,c.name},blankLine:function(a){a.userIndent(0)},indent:function(b,c){var d=b.context.next===h&&c&&c.charAt(0)==="]"?-1:b.userIndentationDelta;return(b.indentation+d)*a.indentUnit},electricChars:"]"}}),CodeMirror.defineMIME("text/x-stsrc",{name:"smalltalk"})