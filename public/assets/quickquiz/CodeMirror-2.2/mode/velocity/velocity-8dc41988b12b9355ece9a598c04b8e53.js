CodeMirror.defineMode("velocity",function(a){function b(a){var b={},c=a.split(" ");for(var d=0;d<c.length;++d)b[c[d]]=!0;return b}function i(a,b,c){return b.tokenize=c,c(a,b)}function j(a,b){var c=b.beforeParams;b.beforeParams=!1;var h=a.next();if(h!='"'&&h!="'"||!b.inParams){if(/[\[\]{}\(\),;\.]/.test(h))return h=="("&&c?b.inParams=!0:h==")"&&(b.inParams=!1),null;if(/\d/.test(h))return a.eatWhile(/[\w\.]/),"number";if(h=="#"&&a.eat("*"))return i(a,b,l);if(h=="#"&&a.match(/ *\[ *\[/))return i(a,b,m);if(h=="#"&&a.eat("#"))return a.skipToEnd(),"comment";if(h=="$")return a.eatWhile(/[\w\d\$_\.{}]/),f&&f.propertyIsEnumerable(a.current().toLowerCase())?"keyword":(b.beforeParams=!0,"builtin");if(g.test(h))return a.eatWhile(g),"operator";a.eatWhile(/[\w\$_{}]/);var j=a.current().toLowerCase();return d&&d.propertyIsEnumerable(j)?"keyword":e&&e.propertyIsEnumerable(j)||a.current().match(/^#[a-z0-9_]+ *$/i)&&a.peek()=="("?(b.beforeParams=!0,"keyword"):null}return i(a,b,k(h))}function k(a){return function(b,c){var d=!1,e,f=!1;while((e=b.next())!=null){if(e==a&&!d){f=!0;break}d=!d&&e=="\\"}return f&&(c.tokenize=j),"string"}}function l(a,b){var c=!1,d;while(d=a.next()){if(d=="#"&&c){b.tokenize=j;break}c=d=="*"}return"comment"}function m(a,b){var c=0,d;while(d=a.next()){if(d=="#"&&c==2){b.tokenize=j;break}d=="]"?c++:d!=" "&&(c=0)}return"meta"}var c=a.indentUnit,d=b("#end #else #break #stop #[[ #]] #{end} #{else} #{break} #{stop}"),e=b("#if #elseif #foreach #set #include #parse #macro #define #evaluate #{if} #{elseif} #{foreach} #{set} #{include} #{parse} #{macro} #{define} #{evaluate}"),f=b("$foreach.count $foreach.hasNext $foreach.first $foreach.last $foreach.topmost $foreach.parent $velocityCount"),g=/[+\-*&%=<>!?:\/|]/,h=!0;return{startState:function(a){return{tokenize:j,beforeParams:!1,inParams:!1}},token:function(a,b){return a.eatSpace()?null:b.tokenize(a,b)}}}),CodeMirror.defineMIME("text/velocity","velocity")