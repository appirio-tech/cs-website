<script src='http://qq-server.herokuapp.com/cometd.js' type='text/javascript'></script> 

<script type='text/javascript'>
$(function() {
  var channel = $('#channel').text();
  var username = '<%= current_user.username %>';

  var cometd = new Faye.Client('http://qq-server.herokuapp.com/cometd', {timeout: 120});
  cometd.disable('websocket');
  
  if(channel) {
    var subscription = cometd.subscribe(channel, function(message) {
      console.log(message);
      m = message.sobject;
      
      $('<div class="answer" id="'+ m.Id +'"><span class="user">'+ username +'</span><span class="language '+ m.Type__c +'">'+ m.Type__c +'</span><span class="correct '+ m.Is_Correct__c +'">'+ m.Is_Correct__c  +'</span><span class="time">'+ m.Elapsed_Time_Seconds__c  +'</span></div>')
        .appendTo('#answers');
    });
    subscription.callback(function() {
      console.log('Subscription is now active!');
    });
    subscription.errback(function(error) {
      console.log(error.message);
    });
  }
});
</script>

<div class="page-heading"><h2 class="melbourne">Today's Results for <%= current_user.username %></h2></div>
<div class="page two-cols-bg top-border">
<!-- Content Wrapper -->
        <div class="challenge-content-wrapper">
            <!-- Widecolumn -->
            <div class="widecolumn fl dvbulletedlist">
                <!-- Challenge Information -->
                <div class="challenge-information">
					<table class="fancytable" style="width:100%">
					    <thead>
					    	<tr>
								<th scope="col">Language</th>
					            <th scope="col">Time</th>
								<th scope="col">Correct</th>
					        </tr>
					    </thead>
					    <tbody>
							<% @answers.each do |answer| %>
					    	<tr>
								<td><%= answer['Type__c'] %></td>
								<td><%= answer['Elapsed_Time_Seconds__c'] %></td>
								<td><%= answer['Is_Correct__c'] %></td>
					        </tr>
							<% end %>
					    </tbody>
					</table>

					<div id="channel">/q/*</div>

                </div><br/><br/>
                <!-- END Challenge Information -->

            </div>
            <!-- END Widecolumn -->
            <!-- Sidebar -->
            <div class="sidebar fr">
                
				<!-- Challenge Sidebar -->
				<div class="challenge-sidebar">
					<%= render "shared/quickquiz-sidebar" %>
				</div>
				<!-- END Challenge Sidebar -->

            </div>
            <!-- END Sidebar -->
            <div class="cl">&nbsp;</div>
        </div>
        <!-- END Content Wrapper -->
</div>

