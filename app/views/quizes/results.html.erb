<script src='<%= ENV['QUICK_QUIZ_STREAMING_URL'] %>/cometd.js' type='text/javascript'></script> 

<script type='text/javascript'>
$(function() {
  var channel = '/q/*';
  var username = '<%= current_user.username %>';

  var cometd = new Faye.Client('<%= ENV['QUICK_QUIZ_STREAMING_URL'] %>/cometd', {timeout: 120});
  cometd.disable('websocket');
  
  if(channel) {
    var subscription = cometd.subscribe(channel, function(message) {
      console.log(message);
      m = message.sobject;
	  // add the new row
	  $('#answers tr:last').after('<tr><td>'+ m.Type__c +'</td><td>'+ m.Elapsed_Time_Seconds__c +'</td><td><img alt="'+ m.Is_Correct__c +'" src="/assets/answer-'+ m.Is_Correct__c +'.png" width="40"/></td></tr>');
    });
    subscription.callback(function() {
      console.log('Subscription is now active!');
    });
    subscription.errback(function(error) {
      console.log(error.message);
    });
  }
});
</script>

<div class="page-heading"><h2 class="melbourne">Today's Results for <%= current_user.username %></h2></div>
<div class="page two-cols-bg top-border">
<!-- Content Wrapper -->
        <div class="challenge-content-wrapper">
            <!-- Widecolumn -->
            <div class="widecolumn fl dvbulletedlist">
                <!-- Challenge Information -->
                <div class="challenge-information">
					<p>Your answers will display as they are processed.</p>
					<table class="fancytable" id="answers" style="width:100%">
					    <thead>
					    	<tr>
								<th scope="col">Language</th>
					            <th scope="col">Time</th>
								<th scope="col">Correct</th>
					        </tr>
					    </thead>
					    <tbody>
							<% @answers.each do |answer| %>
					    	<tr>
								<td><%= answer['Type__c'] %></td>
								<td><%= answer['Elapsed_Time_Seconds__c'] %> seconds</td>
								<td><%= image_tag "answer-#{answer['Is_Correct__c']}.png", :width => "40", :alt => "true" %></td>
					        </tr>
							<% end %>
					    </tbody>
					</table>

                </div><br/><br/>
                <!-- END Challenge Information -->

            </div>
            <!-- END Widecolumn -->
            <!-- Sidebar -->
            <div class="sidebar fr">
                
				<!-- Challenge Sidebar -->
				<div class="challenge-sidebar">
					<%= render "shared/quickquiz-sidebar" %>
				</div>
				<!-- END Challenge Sidebar -->

            </div>
            <!-- END Sidebar -->
            <div class="cl">&nbsp;</div>
        </div>
        <!-- END Content Wrapper -->

</div>

